<%- include('../../partials/header') %>

<h2 class="display-6 text-center">Admin Tools</h2>

<div class="container mt-3">

    <!-- horizontal rule / divider -->
    <div class="row">
        <div class="col-5"></div>
        <div class="col-2">
            <hr class="mt-3">
        </div>
    </div> <!-- end of row -->

    <!-- display any flash messages -->
    <div class="w-50 mx-auto text-center mt-3">
        <%- include('../../partials/flash') %>
    </div>

<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
      <li class="nav-item" role="presentation">
    <button class="nav-link <% if (activeAdminTab === 'kennels') { %>
        active
        <% } %>" id="kennels-tab" data-bs-toggle="tab" data-bs-target="#kennels" type="button" role="tab" aria-controls="kennels" aria-selected="false">Kennels</button>
  </li>
    <button class="nav-link <% if (activeAdminTab === 'dogServices') { %>
        active
        <% } %>" id="dog-services-tab" data-bs-toggle="tab" data-bs-target="#dog-services" type="button" role="tab" aria-controls="dog-services" aria-selected="true">Dog Services</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link <% if (activeAdminTab === 'catServices') { %>
        active
        <% } %>" id="cat-services-tab" data-bs-toggle="tab" data-bs-target="#cat-services" type="button" role="tab" aria-controls="cat-services" aria-selected="false">Cat Services</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link <% if (activeAdminTab === 'employees') { %>
        active
        <% } %>" id="employees-tab" data-bs-toggle="tab" data-bs-target="#employees" type="button" role="tab" aria-controls="employees" aria-selected="false">Employees</button>
  </li>
</ul>

<div class="tab-content" id="myTabContent">

  <div class="tab-pane fade <% if (activeAdminTab === 'kennels') { %>
        show active
    <% } %>" id="kennels" role="tabpanel" aria-labelledby="kennels-tab">

    <div>
        <div class="btn-group mt-3 mb-1">
            <a href="/admin?occupied=true" class="btn btn-outline-primary btn-sm <% if (occupiedOnly) { %>
                active
                <% } %>" >Occupied</a>
            <a href="/admin" class="btn btn-outline-primary btn-sm <% if (!occupiedOnly) { %>
                active
                <% } %>">All</a>
        </div>
    </div>

        <div class="table-responsive" style="max-height: 600px">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col" style="width: 20%;">ID</th>
                        <th scope="col" style="width: 15%;">Occupant</th>
                    </tr>
                </thead>
                <tbody>

                    <% for(let kennel of allKennels) { %>
                            <td valign="middle">
                                <a href="/kennel-records/<%= kennel._id %>/edit" style="text-decoration: none;">
                                <%= kennel.formatted_id %></a>
                            </td>
                            <td valign="middle">

                                <% if (kennel.occupant) { %>
                                    <a href="/guest-records/<%= kennel.occupant._id%>" style="text-decoration: none;"><%=kennel.occupant.name %></a>     
                                    <% } %>
                            </td>
                        </tr>
                        <% } %>

                </tbody>
            </table>
        </div>

    <!-- horizontal rule / divider -->
    <div class="row">
        <div class="col-5"></div>
        <div class="col-2">
            <hr class="mt-3">
        </div>
    </div> <!-- end of row -->

    <div class="mx-auto mt-3 text-center">
        <div class="row mb-3">
            <div class="col-4 mx-auto text-center">
                <a href="/kennel-records/new" class="btn btn-primary">Add New Kennel</a>
            </div>
        </div>
    </div>

    </div> <!-- end of dog services-tab-->

  <div class="tab-pane fade <% if (activeAdminTab === 'dogServices') { %>
        show active
    <% } %>" id="dog-services" role="tabpanel" aria-labelledby="dog-services-tab">
        <div class="table-responsive" style="max-height: 600px">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col" style="width: 20%;">Name</th>
                        <th scope="col" style="width: 15%;">Type</th>
                        <th scope="col" style="width: 15%;">Price</th>
                        <th scope="col" style="width: 35%;">Description</th>
                        <!-- <th style="width: 15%;"></th> -->
                    </tr>
                </thead>
                <tbody>

                    <% for(let service of allServices) { %>
                        <% if (service.petType === 'dog') {%>

                        <tr>
                            <td valign="middle">                                
                                <a href="/service-records/<%=service._id%>/edit" style="text-decoration: none;">
                                    <%= service.name %></a>
                            </td>
                            <td valign="middle"><%= service.formattedServiceType %></td>
                            <td valign="middle">$<%= service.price %></td>
                            <td valign="middle"><%= service.description %>
                            <!-- <td valign="middle" style="text-align: right;">
                                <a href="/service-records/<%=service._id%>/edit" class="btn btn-outline-primary btn-sm">Edit</a> 
                            </td> -->
                        </tr>
                        <% } %>
                    <% } %>

                </tbody>
            </table>
        </div>
    
    <!-- horizontal rule / divider -->
    <div class="row">
        <div class="col-5"></div>
        <div class="col-2">
            <hr class="mt-3">
        </div>
    </div> <!-- end of row -->

    <div class="mx-auto mt-3 text-center">
        <div class="row mb-3">
            <div class="col-4 mx-auto text-center">
                <a href="/service-records/new?petType=dog" class="btn btn-primary">Add New Service</a>
            </div>
        </div>
    </div>

    </div> <!-- end of dog services-tab-->

  <div class="tab-pane fade <% if (activeAdminTab === 'catServices') { %>
        show active
    <% } %> " id="cat-services" role="tabpanel" aria-labelledby="cat-services-tab">
        <div class="table-responsive" style="max-height: 600px">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col" style="width: 25%">Name</th>
                        <th scope="col" style="width: 15%">Type</th>
                        <th scope="col" style="width: 15%">Price</th>
                        <th scope="col" style="width: 45%">Description</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>

                    <% for(let service of allServices) { %>
                        <% if (service.petType ==='cat') {%>

                        <tr>
                            <td>
                                <a href="/service-records/<%=service._id%>/edit" style="text-decoration: none;">
                                    <%= service.name %></a>
                            </td>
                            <td><%= service.formattedServiceType %></td>
                            <td>$<%= service.price %></td>
                            <td>
                                <button class="btn btn-secondary btn-sm" data-bs-toggle="tooltip" data-bs-placement="top" title="<%= service.description %>">Preview</button>
                            </td>
                            <td>
                                <a href="/service-records/<%=service._id%>/edit" class="btn btn-outline-primary btn-sm">Edit</a> 
                            </td>
                        </tr>
                        <% } %>
                    <% } %>

                </tbody>
            </table>
        </div>

    <!-- horizontal rule / divider -->
    <div class="row">
        <div class="col-5"></div>
        <div class="col-2">
            <hr class="mt-3">
        </div>
    </div> <!-- end of row -->

    <div class="mx-auto mt-3 text-center">
        <div class="row mb-3">
            <div class="col-4 mx-auto text-center">
                <a href="/service-records/new?petType=cat" class="btn btn-primary">Add New Service</a>
            </div>
        </div>
    </div>

    </div> <!-- end of cat services-tab-->

  <div class="tab-pane fade <% if (activeAdminTab === 'employees') { %>
        show active
    <% } %> " id="employees" role="tabpanel" aria-labelledby="employees-tab">

        <div class="table-responsive" style="max-height: 600px">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Role</th>
                    <th scope="col">Phone</th>
                    <th scope="col">Username</th>
                    <th></th>
                    </tr>
                </thead>
                <tbody>

                    <% for(let employee of allEmployees) { %>

                    <tr>
                        <td>
                            <a href="/employee-records/<%= employee._id %>" style="text-decoration: none;">
                            <%= employee.fullName %></a>
                        </td>
                        <td><%= employee.role %></td>
                        <td><%= employee.formattedPhone %></td>
                        <td><%= employee.username %></td>
                    </tr>

                    <% } %>

                </tbody>
            </table>
        </div>

        <!-- horizontal rule / divider -->
        <div class="row">
            <div class="col-5"></div>
            <div class="col-2">
                <hr class="mt-3">
            </div>
        </div> <!-- end of row -->

        <div class="mx-auto mt-3 text-center">
            <div class="row mb-3">
                <div class="col-4 mx-auto text-center">
                    <a href="/employee-records/new" class="btn btn-primary">Register New Employee</a>
                </div>
            </div>
        </div>

    </div> <!-- end of employees-tab-->



</div> <!-- end of tab-content -->



    </div>

</div> <!-- end of container-->

<%- include('../../partials/footer') %>

<script>

    $('#dog-services-tab').on('click', function() {
        var tabData = {activeAdminTab: "dogServices" }
        setActiveAdminTab(tabData);
    });

    $('#cat-services-tab').on('click', function() {
        var tabData = {activeAdminTab: "catServices" }
        setActiveAdminTab(tabData);
    });

    $('#employees-tab').on('click', function() {
        var tabData = {activeAdminTab: "employees" }
        setActiveAdminTab(tabData);
    });

    $('#kennels-tab').on('click', function() {
        var tabData = {activeAdminTab: "kennels" }
        setActiveAdminTab(tabData);
    });


    function setActiveAdminTab(tabData) {
        $.ajax({
            url: 'http://localhost:8080/admin/setActiveTab',
            type: "POST",
            data: tabData,
            success: function(data) {
                let x = JSON.stringify(data);
                console.log(x)
            }
        });
    }
</script>